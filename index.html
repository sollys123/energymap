<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç”µåŠ›å¸‚åœºç»¼åˆçƒ­åŠ›å›¾</title>
    
    <!-- 1. Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- 2. React å…¨å®¶æ¡¶ (Staticfile CDN) -->
    <script crossorigin src="https://cdn.staticfile.net/react/18.2.0/umd/react.production.min.js"></script>
    <script crossorigin src="https://cdn.staticfile.net/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
    
    <!-- 3. Babel (Staticfile CDN) -->
    <script src="https://cdn.staticfile.net/babel-standalone/7.22.20/babel.min.js"></script>
    
    <!-- 4. ECharts (Staticfile CDN) -->
    <script src="https://cdn.staticfile.net/echarts/5.4.3/echarts.min.js"></script>

    <style>
        ::-webkit-scrollbar { width: 6px; height: 6px; }
        ::-webkit-scrollbar-track { background: #f1f5f9; }
        ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 3px; }
        ::-webkit-scrollbar-thumb:hover { background: #94a3b8; }
        .fade-in { animation: fadeIn 0.5s ease-in-out; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    </style>
</head>
<body class="bg-slate-50">
    <div id="root"></div>

    <script type="text/babel">
            const { useState, useEffect, useRef, useMemo } = React;

        // --- å›¾æ ‡ç»„ä»¶ ---
        const IconWrapper = ({ children, size = 24, className = "" }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>{children}</svg>
        );
        const X = (props) => (<IconWrapper {...props}><path d="M18 6 6 18"/><path d="m6 6 12 12"/></IconWrapper>);
        const Activity = (props) => (<IconWrapper {...props}><path d="M22 12h-4l-3 9L9 3l-3 9H2"/></IconWrapper>);
        const TrendingUp = (props) => (<IconWrapper {...props}><polyline points="22 7 13.5 15.5 8.5 10.5 2 17"/><polyline points="16 7 22 7 22 13"/></IconWrapper>);
        const BarChart3 = (props) => (<IconWrapper {...props}><path d="M3 3v18h18"/><path d="M18 17V9"/><path d="M13 17V5"/><path d="M8 17v-3"/></IconWrapper>);
        const Coins = (props) => (<IconWrapper {...props}><circle cx="8" cy="8" r="6"/><path d="M18.09 10.37A6 6 0 1 1 10.34 18"/><path d="M7 6h1v4"/><path d="m16.71 13.88.7.71-2.82 2.82"/></IconWrapper>);
        const Zap = (props) => (<IconWrapper {...props}><polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"/></IconWrapper>);
        const ArrowLeft = (props) => (<IconWrapper {...props}><path d="m12 19-7-7 7-7"/><path d="M19 12H5"/></IconWrapper>);
        const MapIcon = (props) => (<IconWrapper {...props}><polygon points="3 6 9 3 15 6 21 3 21 18 15 21 9 18 3 21"/><line x1="9" x2="9" y1="3" y2="18"/><line x1="15" x2="15" y1="6" y2="21"/></IconWrapper>);
        const ChevronLeft = (props) => (<IconWrapper {...props}><path d="m15 18-6-6 6-6"/></IconWrapper>);
        const ChevronRight = (props) => (<IconWrapper {...props}><path d="m9 18 6-6-6-6"/></IconWrapper>);
        const Layers = (props) => (<IconWrapper {...props}><polygon points="12 2 2 7 12 12 22 7 12 2"/><polyline points="2 17 12 22 22 17"/><polyline points="2 12 12 17 22 12"/></IconWrapper>);
        const BatteryCharging = (props) => (<IconWrapper {...props}><path d="M5 18H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h3.19M15 6h2a2 2 0 0 1 2 2v8a2 2 0 0 1-2 2h-3.19"/><line x1="23" x2="23" y1="13" y2="11"/><polyline points="11 6 7 12 13 12 9 18"/></IconWrapper>);

        const EnergyMarketMap = () => {
            const mapContainerRef = useRef(null);
            const chartInstanceRef = useRef(null);
            
            // --- æ ¸å¿ƒçŠ¶æ€ ---
            const [marketType, setMarketType] = useState('frequency'); // 'frequency' (äºŒæ¬¡è°ƒé¢‘) | 'energy' (ç”µèƒ½é‡)
            const [energyView, setEnergyView] = useState('price'); // 'price' | 'spot-progress'
            const [viewMode, setViewMode] = useState('china'); // 'china' | 'province'
            const [currentProvince, setCurrentProvince] = useState(null);
            const [selectedProvinceInfo, setSelectedProvinceInfo] = useState(null);
            const [loading, setLoading] = useState(true);
            const [isSidebarOpen, setIsSidebarOpen] = useState(true);

            // --- çœä»½ Adcode æ˜ å°„ ---
            const adcodeMap = {
                'æ²³åŒ—çœ': 130000, 'å±±è¥¿çœ': 140000, 'å¹¿ä¸œçœ': 440000,
                'ç”˜è‚ƒçœ': 620000, 'æ²³å—çœ': 410000, 'å®å¤å›æ—è‡ªæ²»åŒº': 640000,
                'æ±Ÿè‹çœ': 320000, 'æµ™æ±Ÿçœ': 330000, 'é™•è¥¿çœ': 610000,
                'åŒ—äº¬å¸‚': 110000, 'å¤©æ´¥å¸‚': 120000, 'å±±ä¸œçœ': 370000,
                'å®‰å¾½çœ': 340000, 'ç¦å»ºçœ': 350000, 'ä¸Šæµ·å¸‚': 310000,
                'æ¹–åŒ—çœ': 420000, 'æ¹–å—çœ': 430000, 'æ±Ÿè¥¿çœ': 360000,
                'å‰æ—çœ': 220000, 'é»‘é¾™æ±Ÿçœ': 230000, 'è¾½å®çœ': 210000,
                'å†…è’™å¤è‡ªæ²»åŒº': 150000, 'é’æµ·çœ': 630000, 'æ–°ç–†ç»´å¾å°”è‡ªæ²»åŒº': 650000,
                'å››å·çœ': 510000, 'é‡åº†å¸‚': 500000, 'å¹¿è¥¿å£®æ—è‡ªæ²»åŒº': 450000,
                'è´µå·çœ': 520000, 'äº‘å—çœ': 530000, 'æµ·å—çœ': 460000
            };

            // --- é…ç½®å®šä¹‰ ---
            
            // 1. é¢œè‰²é…ç½® (æ ¹æ®å¸‚åœºç±»å‹åˆ‡æ¢)
            const colorPalettes = {
                frequency: {
                    // çº¢/æ©™/é»„æš–è‰²ç³» (ä»£è¡¨çƒ­åº¦/æ”¶ç›Š)
                    map: ['#991b1b', '#dc2626', '#ea580c', '#fbbf24', '#fef08a'],
                    highlight: '#d97706',
                    iconBg: 'bg-red-50', iconText: 'text-red-600', iconBorder: 'border-red-100',
                    gradientFrom: 'from-red-600', gradientTo: 'to-orange-500'
                },
                energy: {
                    // è“è‰²ç³» (ä»£è¡¨ç”µé‡/è´Ÿè·)
                    map: ['#0ea5e9', '#38bdf8', '#7dd3fc', '#bae6fd', '#e0f2fe'],
                    highlight: '#38bdf8',
                    iconBg: 'bg-sky-50', iconText: 'text-sky-600', iconBorder: 'border-sky-100',
                    gradientFrom: 'from-sky-500', gradientTo: 'to-cyan-400'
                }
            };

            const currentPalette = colorPalettes[marketType];

            // 2. ç‚¹ä½ç±»å‹é…ç½®
            const pointTypeConfig = {
                'N': { color: '#22c55e', symbol: 'circle', label: 'æ–°èƒ½æº (é£/å…‰)', beltColor: '#86efac' },
                'F': { color: '#7e22ce', symbol: 'rect', label: 'ç«ç”µ/ç…¤ç”µ', beltColor: '#d8b4fe' },
                'S': { color: '#0ea5e9', symbol: 'triangle', label: 'è°ƒèŠ‚/æ°´ç”µ/æ ¸ç”µ', beltColor: '#7dd3fc' },
                // ç”µèƒ½é‡å¸‚åœºå¯èƒ½ç”¨åˆ°çš„æ–°ç±»å‹ (é¢„ç•™)
                'L': { color: '#f59e0b', symbol: 'diamond', label: 'è´Ÿè·ä¸­å¿ƒ', beltColor: '#fcd34d' } 
            };

            // --- æ•°æ®æº ---

            // A. äºŒæ¬¡è°ƒé¢‘æ•°æ® (Frequency Data) - æ²¿ç”¨ä¹‹å‰çš„æ•°æ®
            const frequencyData = {
                mapValues: {
                    'æ²³åŒ—çœ': 5000, 'æ²³å—çœ': 4000, 'å¹¿ä¸œçœ': 5000, 
                    'å±±è¥¿çœ': 4100, 'ç”˜è‚ƒçœ': 2500, 'å®å¤å›æ—è‡ªæ²»åŒº': 500
                },
                details: {
                    'æ²³åŒ—çœ': {
                        title: 'æ²³åŒ—çœ (å—ç½‘)', totalVolume: '5000ä¸‡å…ƒ (å‚¨èƒ½ä»½é¢)',
                        marketVolumeDisplay: 'æ¯æœˆå‚¨èƒ½åˆ†æ‘Šä»½é¢çº¦ 5000ä¸‡å…ƒ',
                        tags: ['çƒ­åº¦æœ€é«˜', '2026å¼€æ”¾'],
                        details: [{ label: 'æ•°æ®æ¥æº', value: 'æ²³åŒ—å—ç½‘äº¤æ˜“ä¸­å¿ƒå¸‚åœºå¤„ä¸»ä»»' }]
                    },
                    'æ²³å—çœ': {
                        title: 'æ²³å—çœ', totalVolume: '4000ä¸‡å…ƒ (å‚¨èƒ½ä»½é¢)',
                        marketVolumeDisplay: 'æ¯æœˆå‚¨èƒ½åˆ†æ‘Šä»½é¢çº¦ 4000ä¸‡å…ƒ',
                        tags: ['çƒ­åº¦é«˜', '2027å¼€æ”¾'],
                        details: [{ label: 'æ•°æ®æ¥æº', value: 'æ²³å—è°ƒåº¦è®¡åˆ’å¤„ä¸»ä»»' }]
                    },
                    'å¹¿ä¸œçœ': {
                        title: 'å¹¿ä¸œçœ', totalVolume: '5000ä¸‡å…ƒ',
                        marketVolumeDisplay: 'æ¯æœˆç‹¬ç«‹å‚¨èƒ½å¸‚åœºæ€»é‡ 5000ä¸‡å…ƒå·¦å³',
                        tags: ['æ•°æ®è¯¦å®', 'æ”¶ç›Šå æ¯”90%'],
                        details: [{ label: 'æ•°æ®æ¥æº', value: '5-7æœˆæ”¶ç›Šè¡¨' }]
                    },
                    'å±±è¥¿çœ': {
                        title: 'å±±è¥¿çœ', totalVolume: '4100ä¸‡å…ƒ',
                        marketVolumeDisplay: 'æ¯æœˆå¸‚åœºæ€»é‡ 4100ä¸‡å…ƒ',
                        tags: ['å¸‚åœºæˆç†Ÿ', 'å æ¯”80%'],
                        details: [{ label: 'æ•°æ®æ¥æº', value: 'å®åœ°è°ƒç ” (1-3æœˆæ”¶ç›Šè¡¨)' }]
                    },
                    'ç”˜è‚ƒçœ': {
                        title: 'ç”˜è‚ƒçœ', totalVolume: '2500ä¸‡å…ƒ',
                        marketVolumeDisplay: 'æ¯æœˆå…¨å¸‚åœºè°ƒé¢‘æ€»é‡‘é¢ 2500-2600ä¸‡å…ƒ',
                        tags: ['è¶‹åŠ¿ä¸Šæ¶¨', 'åŠå…¬å¼€æŠ«éœ²'],
                        details: [{ label: 'æ•°æ®æ¥æº', value: 'ç”˜è‚ƒç”µåŠ›äº¤æ˜“ä¸­å¿ƒåŠå…¬å¼€æŠ«éœ²ä¿¡æ¯' }]
                    },
                    'å®å¤å›æ—è‡ªæ²»åŒº': {
                        title: 'å®å¤å›æ—è‡ªæ²»åŒº', totalVolume: '500ä¸‡å…ƒ',
                        marketVolumeDisplay: 'æ¯æœˆæ€»é‡ 500ä¸‡å…ƒå·¦å³',
                        tags: ['æ¶¨å¹…ä¸å¤§', 'å æ¯”5%'],
                        details: [{ label: 'æ•°æ®æ¥æº', value: 'å®åœ°è°ƒç ”' }]
                    }
                },
                provincePoints: {
                    'ç”˜è‚ƒçœ': [
                        { name: 'é™‡ä¸œåŸºåœ°', coord: [107.63, 35.73], type: 'F', label: 'é™‡ä¸œç…¤ç”µåŸºåœ°', desc: 'å‘å£ç…¤ç”µ+å¤–é€ä¸­å¿ƒ' },
                        { name: 'åˆ˜å®¶å³¡', coord: [103.35, 35.93], type: 'S', label: 'é»„æ²³æ¢¯çº§æ°´ç”µ', desc: 'åˆ˜å®¶å³¡è°ƒå³°ä¸»åŠ›' }
                    ],
                    'å®å¤å›æ—è‡ªæ²»åŒº': [
                        { name: 'å®ä¸œåŸºåœ°', coord: [106.66, 38.16], type: 'F', label: 'å®ä¸œèƒ½æºåŒ–å·¥', desc: 'ç…¤ç”µ+åŒ–å·¥+å…‰ä¼' },
                        { name: 'è…¾æ ¼é‡Œ', coord: [105.00, 37.60], type: 'N', label: 'è…¾æ ¼é‡ŒåŸºåœ°', desc: 'æ²™æ¼ å…‰ä¼/é£ç”µ' },
                        { name: 'ä¸­å®æ¢æµç«™', coord: [105.67, 37.48], type: 'S', label: 'ä¸­å®æ¢æµç«™', desc: 'å®ç”µå…¥æ¹˜é€ç«¯' }
                    ],
                    'æ²³å—çœ': [
                        { name: 'å¹³é¡¶å±±', coord: [113.19, 33.76], type: 'F', label: 'å¹³é¡¶å±±ç…¤ç”µ', desc: 'ä¸­åŸç…¤ç”µä¸­å¿ƒ' },
                        { name: 'è±«è¥¿é£ç”µ', coord: [111.50, 34.50], type: 'N', label: 'è±«è¥¿é£ç”µ', desc: 'æ´›é˜³è¥¿éƒ¨å±±åŒº' },
                        { name: 'è±«ä¸œå…‰ä¼', coord: [114.50, 34.60], type: 'N', label: 'è±«ä¸œå…‰ä¼', desc: 'å¼€å°å‘¨è¾¹é›†ä¸­å¼' }
                    ],
                    'æ²³åŒ—çœ': [
                        { name: 'çŸ³å®¶åº„', coord: [114.48, 38.03], type: 'F', label: 'çŸ³å®¶åº„çƒ­ç”µ', desc: 'çœä¼šè´Ÿè·ä¸­å¿ƒ' },
                        { name: 'å†€å—å…‰ä¼', coord: [115.68, 37.73], type: 'N', label: 'å†€å—å…‰ä¼', desc: 'è¡¡æ°´å¹³åŸå…‰ä¼å¸¦' }
                    ],
                    'å¹¿ä¸œçœ': [
                        { name: 'ç²¤è¥¿ç…¤ç”µ', coord: [110.35, 21.27], type: 'F', label: 'ç²¤è¥¿ç…¤ç”µ', desc: 'æ¹›æ±Ÿæ²¿æµ·åŸºåœ°' },
                        { name: 'ç²¤ä¸œç…¤ç”µ', coord: [116.37, 23.55], type: 'F', label: 'ç²¤ä¸œç…¤ç”µ', desc: 'æ­é˜³/æƒ æ¥åŸºåœ°' },
                        { name: 'é˜³æ±Ÿé£ç”µ', coord: [111.98, 21.4], type: 'N', label: 'é˜³æ±Ÿæµ·ä¸Šé£ç”µ', desc: 'è¿‘æµ·é£ç”µé›†ç¾¤' },
                        { name: 'æ±•å°¾é£ç”µ', coord: [115.6, 22.6], type: 'N', label: 'æ±•å°¾æµ·ä¸Šé£ç”µ', desc: 'ç”²å­æµ·åŸŸ' }
                    ]
                },
                provinceBelts: {
                    'ç”˜è‚ƒçœ': [{ name: 'æ²³è¥¿èµ°å»Šæ–°èƒ½æºå¸¦', type: 'N', coords: [[98.50, 39.75], [96.5, 40.5]], label: 'é…’æ³‰-ç“œå·-ç‰é—¨ åŸºåœ°å¸¦' }],
                    'æ²³å—çœ': [{ name: 'è±«åŒ—ç…¤ç”µå¸¦', type: 'F', coords: [[114.35, 36.10], [114.29, 35.74]], label: 'å®‰é˜³-é¹¤å£ ç…¤ç”µå¸¦' }],
                    'æ²³åŒ—çœ': [{ name: 'å†€å—é’¢é“ç…¤ç”µå¸¦', type: 'F', coords: [[114.50, 37.06], [114.47, 36.60]], label: 'é‚¢å°-é‚¯éƒ¸ ç…¤ç”µé’¢é“å¸¦' }],
                    'å¹¿ä¸œçœ': [{ name: 'ç æ±Ÿå£æ ¸ç”µèµ°å»Š', type: 'S', coords: [[112.93, 21.92], [114.54, 22.60], [114.8, 22.7]], label: 'ç æ±Ÿå£æ ¸ç”µèµ°å»Š' }]
                }
            };

            // B. ç”µèƒ½é‡æ•°æ® (Energy Data)
            const rawEnergyPriceData = {
                'åŒ—äº¬å¸‚': { range: [0.318, 0.596], display: '0.318~0.596 å…ƒ/kWh', note: 'ååŒ—ï¼šå³°è°·ä»·å·®åŒºé—´', category: 'market' },
                'å¤©æ´¥å¸‚': { value: 0.51, display: '0.51 å…ƒ/kWh', note: 'ååŒ—ï¼šå•æ¬¡è°·å……å³°æ”¾æµ‹ç®—', category: 'market' },
                'æ²³åŒ—çœ': { range: [0.43, 0.6], display: '0.43â€“0.6 å…ƒ/kWh', note: 'ä¸¤å……ä¸¤æ”¾ä»·å·®çº¦ 0.43ï¼›ä¸€å……ä¸€æ”¾çº¦ 0.6', category: 'actual' },
                'å±±ä¸œçœ': { value: 0.601, display: '0.601 å…ƒ/kWh', note: 'ååŒ—ï¼šå•æ¬¡è°·å……å³°æ”¾', category: 'market' },
                'å±±è¥¿çœ': { value: 0.45, display: '0.45 å…ƒ/kWh', note: 'ååŒ—ï¼šæµ‹ç®—ä»·å·®', category: 'actual' },
                'å®‰å¾½çœ': { range: [0.257, 0.607], display: '0.257~0.607 å…ƒ/kWh', note: 'åä¸œï¼šå³°è°·ä»·å·®åŒºé—´', category: 'market' },
                'ç¦å»ºçœ': { range: [0.216, 0.452], display: '0.216~0.452 å…ƒ/kWh', note: 'åä¸œï¼šå³°è°·ä»·å·®åŒºé—´', category: 'market' },
                'ä¸Šæµ·å¸‚': { value: 0.679, display: '0.679 å…ƒ/kWhï¼ˆåªèƒ½åšä¸€æ¬¡è°·å……å³°æ”¾ï¼‰', note: 'åä¸œï¼šå•æ¬¡æ“ä½œ', category: 'market' },
                'æ±Ÿè‹çœ': { value: 0.2, display: '0.2 å…ƒ/kWh', note: 'åä¸œï¼šå®æµ‹ä»·å·®', category: 'actual' },
                'æµ™æ±Ÿçœ': { value: 0.1, display: '0.1 å…ƒ/kWh', note: 'åä¸œï¼šå®æµ‹ä»·å·®', category: 'actual' },
                'æ²³å—çœ': { value: 0.4, display: '0.4 å…ƒ/kWh', note: 'åä¸­ï¼šå®æµ‹ä»·å·®', category: 'actual' },
                'æ¹–åŒ—çœ': { range: [0.229, 0.562], display: '0.229~0.562 å…ƒ/kWhï¼ˆå…¨å¹´ 2 å°æ—¶å°–å³°ï¼‰', note: 'åä¸­ï¼šä¸¤å°æ—¶å°–å³°çª—å£', category: 'market' },
                'æ¹–å—çœ': { range: [0.246, 0.492], display: '0.246~0.492 å…ƒ/kWh', note: 'åä¸­ï¼šå³°è°·ä»·å·®åŒºé—´', category: 'market' },
                'æ±Ÿè¥¿çœ': { range: [0.273, 0.547], display: '0.273~0.547 å…ƒ/kWh', note: 'åä¸­ï¼šå³°è°·ä»·å·®åŒºé—´', category: 'market' },
                'å‰æ—çœ': { value: 0.469, display: '0.469 å…ƒ/kWh', note: 'ä¸œåŒ—ï¼šå•æ¬¡è°·å……å³°æ”¾', category: 'market' },
                'é»‘é¾™æ±Ÿçœ': { value: 0.395, display: '0.395 å…ƒ/kWh', note: 'ä¸œåŒ—ï¼šå•æ¬¡è°·å……å³°æ”¾', category: 'market' },
                'è¾½å®çœ': { value: 0.423, display: '0.423 å…ƒ/kWh', note: 'ä¸œåŒ—ï¼šå•æ¬¡è°·å……å³°æ”¾', category: 'market' },
                'å†…è’™å¤è‡ªæ²»åŒº': { range: [0.223, 0.407], display: 'è’™ä¸œï¼š0.342ï¼›è’™è¥¿ï¼š0.223~0.407 å…ƒ/kWh', note: 'è’™ä¸œå…¨å¹´ä¸¤æ¬¡è°·æ®µå……ç”µ + é«˜å³°æ”¾ç”µï¼›è’™è¥¿ä¸ºå³°è°·åŒºé—´', category: 'market' },
                'ç”˜è‚ƒçœ': { value: 0.27, display: '0.27 å…ƒ/kWhï¼ˆæ²³è¥¿å‡ä»·çº¦ 0.27ï¼‰', note: '454 ä¸ªèŠ‚ç‚¹ï¼Œæ²³è¥¿å‡ä»·çº¦ 0.27', category: 'actual' },
                'å®å¤å›æ—è‡ªæ²»åŒº': { value: 0.32, display: '0.32 å…ƒ/kWhï¼ˆå¯åšé‡‘èå¥—åˆ©ï¼‰', note: 'å¯åšé‡‘èå¥—åˆ©', category: 'actual' },
                'é’æµ·çœ': { range: [0.231, 0.455], display: '0.231~0.455 å…ƒ/kWh', note: 'è¥¿åŒ—ï¼šå³°è°·ä»·å·®åŒºé—´', category: 'market' },
                'é™•è¥¿çœ': { value: 0.4, display: '0.4 å…ƒ/kWh', note: 'è¥¿åŒ—ï¼šå®æµ‹ä»·å·®', category: 'actual' },
                'æ–°ç–†ç»´å¾å°”è‡ªæ²»åŒº': { range: [0.136, 0.290], display: '0.136~0.290 å…ƒ/kWh', note: 'è¥¿åŒ—ï¼šå³°è°·ä»·å·®åŒºé—´', category: 'market' },
                'å››å·çœ': { range: [0.166, 0.332], display: '0.166~0.332 å…ƒ/kWh', note: 'è¥¿å—ï¼šå³°è°·ä»·å·®åŒºé—´', category: 'market' },
                'é‡åº†å¸‚': { range: [0.262, 0.533], display: '0.262~0.533 å…ƒ/kWh', note: 'è¥¿å—ï¼šå³°è°·ä»·å·®åŒºé—´', category: 'market' },
                'å¹¿ä¸œçœ': { value: 0.18, display: '0.18 å…ƒ/kWh', note: 'å—ç½‘ï¼šå®æµ‹ä»·å·®', category: 'actual' },
                'å¹¿è¥¿å£®æ—è‡ªæ²»åŒº': { range: [0.205, 0.411], display: '0.205~0.411 å…ƒ/kWh', note: 'å—ç½‘ï¼šå³°è°·ä»·å·®åŒºé—´', category: 'market' },
                'è´µå·çœ': { range: [0.231, 0.463], display: '0.231~0.463 å…ƒ/kWh', note: 'å—ç½‘ï¼šå³°è°·ä»·å·®åŒºé—´', category: 'market' },
                'äº‘å—çœ': { value: 0.28, display: '0.28 å…ƒ/kWh', note: 'å—ç½‘ï¼šå•æ¬¡è°·å……å³°æ”¾', category: 'market' },
                'æµ·å—çœ': { range: [0.397, 0.737], display: '0.397~0.737 å…ƒ/kWh', note: 'å—ç½‘ï¼šå³°è°·ä»·å·®åŒºé—´', category: 'market' }
            };

            const buildEnergyData = () => {
                const mapValues = {};
                const details = {};
                const categoryMap = {};
                const displayMap = {};
                const noteMap = {};
                const rangeMap = {};
                const actualValues = [];
                const marketValues = [];

                Object.entries(rawEnergyPriceData).forEach(([name, info]) => {
                    const midValue = info.value ?? (((info.range?.[0] || 0) + (info.range?.[1] || 0)) / 2);
                    mapValues[name] = midValue;
                    categoryMap[name] = info.category;
                    displayMap[name] = info.display;
                    noteMap[name] = info.note;
                    rangeMap[name] = info.range;
                    (info.category === 'actual' ? actualValues : marketValues).push(midValue);

                    details[name] = {
                        title: `${name} ç”µèƒ½é‡ä»·å·®`,
                        totalVolume: info.display,
                        marketVolumeDisplay: info.note ? `${info.display} ï½œ ${info.note}` : info.display,
                        tags: [info.category === 'actual' ? 'å®æµ‹æ•°æ®' : 'å¸‚åœºåŒºé—´', info.range ? 'æä¾›èŒƒå›´' : 'å•ç‚¹æ•°æ®'],
                        details: [
                            { label: 'ä»·æ ¼/ä»·å·®', value: info.display },
                            ...(info.range ? [{ label: 'èŒƒå›´æ•°å€¼', value: `${info.range[0]} ~ ${info.range[1]} å…ƒ/kWh` }] : []),
                            info.note ? { label: 'å¤‡æ³¨', value: info.note } : null
                        ].filter(Boolean)
                    };
                });

                const calcRange = (values) => {
                    if (!values.length) return { min: 0, max: 1 };
                    return { min: Math.min(...values), max: Math.max(...values) };
                };

                return {
                    mapValues,
                    details,
                    categoryMap,
                    displayMap,
                    noteMap,
                    rangeMap,
                    ranges: {
                        actual: calcRange(actualValues),
                        market: calcRange(marketValues)
                    }
                };
            };

            const energyData = buildEnergyData();

            // C. ç”µèƒ½é‡æ”¿ç­–çƒ­åŠ›æ•°æ®
            const policyLevelConfig = {
                1: { label: 'æ— æ”¿ç­–', desc: 'æš‚æ— å‚¨èƒ½ç›¸å…³ä¸­é•¿æœŸ/ç°è´§æ”¿ç­–' },
                2: { label: 'ç»è¥ä¸»ä½“åŒ…å«å‚¨èƒ½', desc: 'ç»è¥ä¸»ä½“å±‚é¢æ˜ç¡®åŒ…å«å‚¨èƒ½' },
                3: { label: 'äº¤æ˜“ç»†åˆ™åŒ…å«å‚¨èƒ½', desc: 'äº¤æ˜“ç»†åˆ™æ˜ç¡®è¦†ç›–å‚¨èƒ½' }
            };

            const provinceAlias = {
                'åŒ—äº¬': 'åŒ—äº¬å¸‚', 'å¤©æ´¥': 'å¤©æ´¥å¸‚', 'æ²³åŒ—å—ç½‘': 'æ²³åŒ—çœ', 'å†€åŒ—': 'æ²³åŒ—çœ',
                'å±±ä¸œ': 'å±±ä¸œçœ', 'å±±è¥¿': 'å±±è¥¿çœ', 'å®‰å¾½': 'å®‰å¾½çœ', 'ç¦å»º': 'ç¦å»ºçœ',
                'ä¸Šæµ·': 'ä¸Šæµ·å¸‚', 'æ±Ÿè‹': 'æ±Ÿè‹çœ', 'æµ™æ±Ÿ': 'æµ™æ±Ÿçœ', 'æ¹–åŒ—': 'æ¹–åŒ—çœ',
                'æ¹–å—': 'æ¹–å—çœ', 'æ²³å—': 'æ²³å—çœ', 'æ±Ÿè¥¿': 'æ±Ÿè¥¿çœ', 'å‰æ—': 'å‰æ—çœ',
                'é»‘é¾™æ±Ÿ': 'é»‘é¾™æ±Ÿçœ', 'è¾½å®': 'è¾½å®çœ', 'ç”˜è‚ƒ': 'ç”˜è‚ƒçœ', 'å®å¤': 'å®å¤å›æ—è‡ªæ²»åŒº',
                'é’æµ·': 'é’æµ·çœ', 'é™•è¥¿': 'é™•è¥¿çœ', 'æ–°ç–†': 'æ–°ç–†ç»´å¾å°”è‡ªæ²»åŒº', 'å››å·': 'å››å·çœ',
                'é‡åº†': 'é‡åº†å¸‚', 'å¹¿ä¸œ': 'å¹¿ä¸œçœ', 'å¹¿è¥¿': 'å¹¿è¥¿å£®æ—è‡ªæ²»åŒº', 'è´µå·': 'è´µå·çœ',
                'äº‘å—': 'äº‘å—çœ', 'æµ·å—': 'æµ·å—çœ', 'è’™è¥¿': 'å†…è’™å¤è‡ªæ²»åŒº', 'è’™ä¸œ': 'å†…è’™å¤è‡ªæ²»åŒº',
                'çœé—´ï¼ˆå›½ç½‘ã€è’™è¥¿ï¼‰': 'è·¨çœï¼ˆå›½ç½‘-è’™è¥¿ï¼‰', 'çœé—´(å›½ç½‘ä¸è’™è¥¿)': 'è·¨çœï¼ˆå›½ç½‘-è’™è¥¿ï¼‰', 'å—æ–¹åŒºåŸŸ': 'å—æ–¹åŒºåŸŸ'
            };

            const normalizeProvince = (name) => provinceAlias[name] || name;

            const buildPolicyData = (entries, title) => {
                const mapValues = {};
                const details = {};

                entries.forEach(([rawName, value]) => {
                    const name = normalizeProvince(rawName);
                    const level = Math.max(mapValues[name] ?? 1, value ?? 1);
                    mapValues[name] = level;

                    const levelInfo = policyLevelConfig[level] || policyLevelConfig[1];
                    details[name] = {
                        title: `${name} ${title}`,
                        totalVolume: `æ”¿ç­–ç­‰çº§ï¼š${levelInfo.label}`,
                        marketVolumeDisplay: levelInfo.desc,
                        tags: [title, levelInfo.label],
                        heatValue: level,
                        details: [
                            { label: 'ç¼–ç ', value: level },
                            { label: 'æ”¿ç­–ç­‰çº§', value: levelInfo.label },
                            { label: 'è¯´æ˜', value: levelInfo.desc }
                        ]
                    };
                });

                return { mapValues, details };
            };

            const buildSpotProgressData = (entries, longPolicyData, spotPolicyData) => {
                const mapValues = {};
                const details = {};
                const remarkMap = {};
                const policyMap = {};

                entries.forEach(([rawName, rawLevel, remark]) => {
                    const name = normalizeProvince(rawName);
                    const level = Math.max(0, Math.min(5, Number(rawLevel) || 0));
                    const currentLevel = mapValues[name] ?? 0;
                    const finalLevel = level > currentLevel ? level : currentLevel;

                    const longPolicyLevel = longPolicyData?.mapValues?.[name];
                    const spotPolicyLevel = spotPolicyData?.mapValues?.[name];

                    if (adcodeMap[name]) {
                        mapValues[name] = finalLevel;
                    }

                    remarkMap[name] = remark;
                    policyMap[name] = { long: longPolicyLevel, spot: spotPolicyLevel };
                    details[name] = {
                        title: `${name} ç°è´§å¸‚åœºè¿›ç¨‹`,
                        totalVolume: `æˆç†Ÿåº¦ç­‰çº§ï¼š${finalLevel}çº§`,
                        marketVolumeDisplay: remark || 'æš‚æ— å¤‡æ³¨ä¿¡æ¯',
                        tags: [
                            'ç°è´§å¸‚åœºè¿›ç¨‹',
                            `${finalLevel}çº§`,
                            longPolicyLevel ? `ä¸­é•¿æœŸæ”¿ç­–${longPolicyLevel}çº§` : null,
                            spotPolicyLevel ? `ç°è´§æ”¿ç­–${spotPolicyLevel}çº§` : null
                        ].filter(Boolean),
                        heatValue: finalLevel,
                        remark,
                        details: [
                            { label: 'æˆç†Ÿåº¦ç­‰çº§', value: `${finalLevel}çº§` },
                            remark ? { label: 'è¿›å±•è¯´æ˜', value: remark } : null,
                            longPolicyLevel ? { label: 'ä¸­é•¿æœŸæ”¿ç­–ç­‰çº§', value: `${longPolicyLevel}çº§` } : null,
                            spotPolicyLevel ? { label: 'ç°è´§æ”¿ç­–ç­‰çº§', value: `${spotPolicyLevel}çº§` } : null
                        ].filter(Boolean)
                    };
                });

                return { mapValues, details, remarkMap, policyMap };
            };

            const longTermPolicyData = buildPolicyData([
                ['åŒ—äº¬', 1], ['å¤©æ´¥', 3], ['æ²³åŒ—å—ç½‘', 3], ['å†€åŒ—', 3], ['å±±ä¸œ', 2], ['å±±è¥¿', 2],
                ['å®‰å¾½', 3], ['ç¦å»º', 3], ['ä¸Šæµ·', 2], ['æ±Ÿè‹', 2], ['æµ™æ±Ÿ', 2], ['æ¹–åŒ—', 2],
                ['æ¹–å—', 2], ['æ²³å—', 2], ['æ±Ÿè¥¿', 2], ['å‰æ—', 3], ['é»‘é¾™æ±Ÿ', 3], ['è¾½å®', 2],
                ['ç”˜è‚ƒ', 2], ['å®å¤', 3], ['é’æµ·', 3], ['é™•è¥¿', 3], ['æ–°ç–†', 3], ['å››å·', 3],
                ['é‡åº†', 2], ['è’™è¥¿', 2], ['å¹¿ä¸œ', 3], ['å¹¿è¥¿', 3], ['è´µå·', 3], ['äº‘å—', 2], ['æµ·å—', 3]
            ], 'ä¸­é•¿æœŸæ”¿ç­–');

            const spotPolicyData = buildPolicyData([
                ['åŒ—äº¬', 1], ['å¤©æ´¥', 1], ['æ²³åŒ—å—ç½‘', 3], ['å†€åŒ—', 1], ['å±±ä¸œ', 3], ['å±±è¥¿', 3],
                ['å®‰å¾½', 3], ['ç¦å»º', 3], ['ä¸Šæµ·', 2], ['æ±Ÿè‹', 3], ['æµ™æ±Ÿ', 3], // æµ™æ±Ÿç›®å‰ä¸å‚ä¸ç°è´§
                ['æ¹–åŒ—', 3],
                ['æ¹–å—', 3], ['æ²³å—', 3], ['æ±Ÿè¥¿', 3], ['å‰æ—', 3], ['é»‘é¾™æ±Ÿ', 3], ['è¾½å®', 3],
                ['ç”˜è‚ƒ', 3], ['å®å¤', 3], ['é’æµ·', 3], ['é™•è¥¿', 3], ['æ–°ç–†', 3], ['å››å·', 3],
                ['é‡åº†', 3], ['è’™è¥¿', 3], ['å¹¿ä¸œ', 3], ['å¹¿è¥¿', 3], ['è´µå·', 3], ['äº‘å—', 3], ['æµ·å—', 3]
            ], 'ç°è´§æ”¿ç­–');

            const spotProgressData = buildSpotProgressData([
                ['åŒ—äº¬', 0, 'è¡¨æ ¼ä¸­æœªç»™å‡ºåŒ—äº¬ç°è´§å¸‚åœºè¿›ç¨‹çš„å…·ä½“è¯´æ˜'],
                ['å¤©æ´¥', 0, 'è¡¨æ ¼ä¸­æœªç»™å‡ºå¤©æ´¥ç°è´§å¸‚åœºè¿›ç¨‹çš„å…·ä½“è¯´æ˜'],
                ['æ²³åŒ—å—ç½‘', 4, '2023å¹´9æœˆå¼€å§‹é¦–æ¬¡ç»“ç®—è¯•è¿è¡Œï¼Œ2024å¹´11æœˆè¿›è¡Œç¬¬äºŒè½®é•¿å‘¨æœŸç»“ç®—è¯•è¿è¡Œï¼Œ2025å¹´3æœˆ1æ—¥èµ·å¼€å±•è¿ç»­ç»“ç®—è¯•è¿è¡Œ'],
                ['å†€åŒ—', 0, 'è¡¨æ ¼ä¸­æœªç»™å‡ºå†€åŒ—ç°è´§å¸‚åœºè¿›ç¨‹çš„å…·ä½“è¯´æ˜'],
                ['å±±ä¸œ', 5, 'è‡ª2021å¹´12æœˆèµ·å¼€å±•é•¿å‘¨æœŸä¸é—´æ–­ç»“ç®—è¯•è¿è¡Œå¹¶æŒç»­æ¨è¿›ï¼Œ2024å¹´6æœˆ17æ—¥è½¬å…¥ç°è´§å¸‚åœºæ­£å¼è¿è¡Œ'],
                ['å±±è¥¿', 5, '2021å¹´4æœˆèµ·è¿ç»­ä¸‰ä¸ªæœˆå¼€å±•ç»“ç®—è¯•è¿è¡Œï¼Œ2023å¹´12æœˆ22æ—¥è½¬å…¥ç°è´§å¸‚åœºæ­£å¼è¿è¡Œ'],
                ['å®‰å¾½', 4, '2024å¹´5æœˆè¿›è¡Œç¬¬ä¸€æ¬¡æ•´æœˆç»“ç®—è¯•è¿è¡Œï¼Œ2024å¹´12æœˆ31æ—¥èµ·å¼€å±•è¿ç»­ç»“ç®—è¯•è¿è¡Œ'],
                ['ç¦å»º', 3, '2024å¹´11æœˆå¼€å±•é¦–æ¬¡å…¨æœˆç»“ç®—è¯•è¿è¡Œï¼Œ2025å¹´3æœˆè¿›å…¥é•¿å‘¨æœŸç»“ç®—è¯•è¿è¡Œé˜¶æ®µ'],
                ['ä¸Šæµ·', 4, '2025å¹´åˆå¤šæ¬¡ç»“ç®—è¯•è¿è¡Œå¹¶åœ¨5æœˆå®Œæˆæ•´æœˆç»“ç®—è¯•è¿è¡Œï¼ŒåŒå¹´10æœˆ29æ—¥å¯åŠ¨è¿ç»­ç»“ç®—è¯•è¿è¡Œ'],
                ['æ±Ÿè‹', 4, '2024å¹´12æœˆå®Œæˆç¬¬å…­æ¬¡ç»“ç®—è¯•è¿è¡Œï¼Œ2025å¹´6æœˆ1æ—¥å¼€å±•é•¿å‘¨æœŸç»“ç®—è¯•è¿è¡Œå¹¶äº9æœˆèµ·è¿›å…¥è¿ç»­ç»“ç®—è¯•è¿è¡Œ'],
                ['æµ™æ±Ÿ', 5, '2024å¹´5æœˆå¯åŠ¨é•¿å‘¨æœŸè¿ç»­ç»“ç®—è¯•è¿è¡Œï¼Œ2025å¹´8æœˆ7æ—¥èµ·è½¬å…¥ç°è´§å¸‚åœºæ­£å¼è¿è¡Œ'],
                ['æ¹–åŒ—', 5, '2024å¹´4æœˆ16æ—¥å¼€å±•ç¬¬äºŒè½®é•¿å‘¨æœŸç»“ç®—è¯•è¿è¡Œï¼Œ2025å¹´6æœˆ6æ—¥èµ·è½¬å…¥ç°è´§å¸‚åœºæ­£å¼è¿è¡Œ'],
                ['æ¹–å—', 4, '2024å¹´11æœˆå¼€å±•é¦–æ¬¡æ•´æœˆç»“ç®—è¯•è¿è¡Œå’Œåç»­ç»“ç®—è¯•è¿è¡Œï¼Œ2025å¹´10æœˆ28æ—¥èµ·å¯åŠ¨è¿ç»­ç»“ç®—è¯•è¿è¡Œ'],
                ['æ²³å—', 3, '2024å¹´5æœˆ15æ—¥è‡³6æœˆ14æ—¥å¼€å±•ç»“ç®—è¯•è¿è¡Œï¼Œ2025å¹´9æœˆå¼€å±•æ•´æœˆç»“ç®—è¯•è¿è¡Œ'],
                ['æ±Ÿè¥¿', 4, '2023å¹´6æœˆ14æ—¥é¦–æ¬¡ç»“ç®—è¯•è¿è¡Œï¼Œ2025å¹´8æœˆä¸‹æ—¬è‡³9æœˆè¿›è¡Œè°ƒç”µè¯•è¿è¡Œå¹¶äº10æœˆ1æ—¥èµ·è¿›å…¥è¿ç»­ç»“ç®—é˜¶æ®µ'],
                ['å‰æ—', 4, '2024å¹´11æœˆä¸­æ—¬è¿›è¡Œç¬¬ä¸€æ¬¡ç»“ç®—è¯•è¿è¡Œï¼Œ2025å¹´7æœˆ2æ—¥å®Œæˆé¦–æ¬¡æ•´æœˆç»“ç®—ï¼Œå¹¶ä»9æœˆ1æ—¥èµ·å¯åŠ¨è¿ç»­ç»“ç®—è¯•è¿è¡Œ'],
                ['é»‘é¾™æ±Ÿ', 4, '2022å¹´12æœˆå…ˆåå¼€å±•æ¨¡æ‹Ÿè¯•è¿è¡Œå’Œè°ƒç”µè¯•è¿è¡Œï¼Œ2025å¹´8æœˆ1æ—¥èµ·è¿›è¡Œè¿ç»­ç»“ç®—è¯•è¿è¡Œ'],
                ['è¾½å®', 4, '2024å¹´11æœˆå¼€å±•é¦–æ¬¡æ•´æœˆç»“ç®—è¯•è¿è¡Œï¼Œ2025å¹´3æœˆ1æ—¥èµ·å¼€å±•è¿ç»­ç»“ç®—è¯•è¿è¡Œ'],
                ['è’™ä¸œ', 4, '2025å¹´3æœˆä¸­æ—¬å¼€å±•é¦–æ¬¡ç»“ç®—è¯•è¿è¡Œï¼Œ7æœˆ31æ—¥å®Œæˆæ•´æœˆç»“ç®—è¯•è¿è¡Œå¹¶äº10æœˆ20æ—¥è½¬å…¥è¿ç»­ç»“ç®—è¯•è¿è¡Œ'],
                ['ç”˜è‚ƒ', 5, '2021å¹´5æœˆèµ·å¼€å±•è¿ç»­ä¸é—´æ–­ç»“ç®—è¯•è¿è¡Œï¼Œ2024å¹´9æœˆ5æ—¥è½¬å…¥ç°è´§å¸‚åœºæ­£å¼è¿è¡Œ'],
                ['å®å¤', 4, '2024å¹´11æœˆå¼€å±•é¦–æ¬¡æ•´æœˆç»“ç®—è¯•è¿è¡Œï¼Œ2025å¹´5æœˆä¸‹æ—¬è‡³7æœˆå¼€å±•å¤šæ¬¡ç»“ç®—è¯•è¿è¡Œå¹¶è®¡åˆ’è‡ª10æœˆ1æ—¥èµ·è¿›å…¥è¿ç»­ç»“ç®—è¯•è¿è¡Œ'],
                ['é’æµ·', 4, '2024å¹´11æœˆä¸Šæ—¬é¦–æ¬¡ç»“ç®—è¯•è¿è¡Œï¼Œ2025å¹´å¤šæ¬¡ç»“ç®—è¯•è¿è¡Œåè‡ª10æœˆ28æ—¥èµ·å¼€å§‹è¿ç»­è¯•è¿è¡Œ'],
                ['é™•è¥¿', 4, '2024å¹´5æœˆ15æ—¥è‡³6æœˆ13æ—¥å¼€å±•æ•´æœˆç»“ç®—è¯•è¿è¡Œï¼Œå¹¶äº2024å¹´12æœˆ31æ—¥è¿›å…¥è¿ç»­ç»“ç®—è¯•è¿è¡Œ'],
                ['æ–°ç–†', 4, '2024å¹´12æœˆä¸‹æ—¬åŠ2025å¹´å¤šæ¬¡å¼€å±•ç»“ç®—è¯•è¿è¡Œï¼Œ2025å¹´10æœˆ11æ—¥è½¬å…¥æ›´é«˜çº§åˆ«çš„è¿ç»­è¿è¡Œé˜¶æ®µ'],
                ['å››å·', 3, '2020å¹´9æœˆè¿›è¡Œæ°´ç”µç«ä»·è¿ç»­720å°æ—¶ç»“ç®—è¯•è¿è¡Œï¼Œ2022å¹´7æœˆå¼€å±•æ°´ç”µç°è´§è°ƒç”µè¯•è¿è¡Œï¼Œ2025å¹´6æœˆè‡³9æœˆå®‰æ’æ¨¡æ‹Ÿè¯•è¿è¡Œ'],
                ['é‡åº†', 4, '2024å¹´11æœˆå®Œæˆé¦–æ¬¡æ•´æœˆç»“ç®—è¯•è¿è¡Œï¼Œ2025å¹´5æœˆè‡³6æœˆè¿›è¡Œé•¿å‘¨æœŸå¤šæœˆç»“ç®—è¯•è¿è¡Œå¹¶è®¡åˆ’è‡ª11æœˆ1æ—¥èµ·å¯åŠ¨è¿ç»­ç»“ç®—è¯•è¿è¡Œ'],
                ['è’™è¥¿', 5, '2022å¹´6æœˆ1æ—¥å¯åŠ¨è¿ç»­ç»“ç®—è¯•è¿è¡Œï¼Œ2025å¹´2æœˆ24æ—¥è½¬å…¥ç°è´§å¸‚åœºæ­£å¼è¿è¡Œ'],
                ['çœé—´ï¼ˆå›½ç½‘ã€è’™è¥¿ï¼‰', 5, '2022å¹´1æœˆå¯åŠ¨è¯•è¿è¡Œï¼Œ2024å¹´10æœˆ15æ—¥è½¬å…¥æ­£å¼è¿è¡Œ'],
                ['å¹¿ä¸œ', 5, '2019å¹´5æœˆå¯åŠ¨ç°è´§å¸‚åœºç»“ç®—è¯•è¿è¡Œï¼Œ2023å¹´12æœˆ28æ—¥è½¬å…¥æ­£å¼è¿è¡Œ'],
                ['å¹¿è¥¿', 4, '2024å¹´11æœˆå¼€å±•å…¨æœˆç»“ç®—è¯•è¿è¡Œï¼Œ2025å¹´6æœˆ29æ—¥èµ·è½¬å…¥è¿ç»­ç»“ç®—è¯•è¿è¡Œ'],
                ['è´µå·', 4, '2024å¹´11æœˆå¼€å±•å…¨æœˆç»“ç®—è¯•è¿è¡Œï¼Œ2025å¹´6æœˆ29æ—¥èµ·è½¬å…¥è¿ç»­ç»“ç®—è¯•è¿è¡Œ'],
                ['äº‘å—', 4, '2024å¹´11æœˆå¼€å±•å…¨æœˆç»“ç®—è¯•è¿è¡Œï¼Œ2025å¹´6æœˆ29æ—¥èµ·è½¬å…¥è¿ç»­ç»“ç®—è¯•è¿è¡Œ'],
                ['æµ·å—', 4, '2024å¹´11æœˆå¼€å±•å…¨æœˆç»“ç®—è¯•è¿è¡Œï¼Œ2025å¹´6æœˆ29æ—¥èµ·è½¬å…¥è¿ç»­ç»“ç®—è¯•è¿è¡Œ'],
                ['å—æ–¹åŒºåŸŸ', 4, 'å—æ–¹åŒºåŸŸæ•´ä½“åœ¨2024å¹´11æœˆå¼€å±•å…¨æœˆç»“ç®—è¯•è¿è¡Œå¹¶äº2025å¹´6æœˆ29æ—¥èµ·è¿›å…¥è¿ç»­ç»“ç®—è¯•è¿è¡Œ'],
                ['çœé—´(å›½ç½‘ä¸è’™è¥¿)', 6, 'çœé—´ç°è´§å¸‚åœºè‡ª2022å¹´1æœˆå¯åŠ¨è¯•è¿è¡Œå¹¶äº2024å¹´10æœˆ15æ—¥è½¬å…¥æ­£å¼è¿è¡Œ']
            ], longTermPolicyData, spotPolicyData);

            // --- è¾…åŠ©æ•°æ® ---
            const deepBlueProvinces = ['æ±Ÿè‹çœ', 'æµ™æ±Ÿçœ', 'å®‰å¾½çœ', 'å±±ä¸œçœ'];
            const blueProvinces = ['è´µå·çœ', 'äº‘å—çœ', 'å¹¿è¥¿å£®æ—è‡ªæ²»åŒº', 'æ¹–å—çœ', 'æ¹–åŒ—çœ', 'æ±Ÿè¥¿çœ', 'å†…è’™å¤è‡ªæ²»åŒº'];
            const lightBlueProvinces = ['æ–°ç–†ç»´å¾å°”è‡ªæ²»åŒº', 'é»‘é¾™æ±Ÿçœ', 'å‰æ—çœ', 'è¾½å®çœ', 'é’æµ·çœ'];

            const actualDataProvinces = ['æ²³åŒ—çœ', 'å±±è¥¿çœ', 'æ±Ÿè‹çœ', 'æµ™æ±Ÿçœ', 'æ²³å—çœ', 'ç”˜è‚ƒçœ', 'å®å¤å›æ—è‡ªæ²»åŒº', 'é™•è¥¿çœ', 'å¹¿ä¸œçœ'];

            const energyColorScale = {
                actual: ['#fffbeb', '#fef3c7', '#fde68a', '#fbbf24', '#f59e0b'],
                market: ['#f0f9ff', '#bae6fd', '#7dd3fc', '#38bdf8', '#0ea5e9']
            };

            const formatPriceLabel = (value) => {
                if (!isFinite(value)) return '--';
                return value >= 1 ? value.toFixed(1) : value.toFixed(2);
            };

            const buildScaleLabels = ({ min, max }) => {
                if (!isFinite(min) || !isFinite(max)) return [];
                if (min === max) return [max];
                return [max, min];
            };

            const actualScaleLabels = buildScaleLabels(energyData.ranges.actual);
            const marketScaleLabels = buildScaleLabels(energyData.ranges.market);

            const spotProgressColorScale = ['#ffffff', '#e0f2ff', '#b7d7ff', '#8abaff', '#4f8df9', '#1d4ed8']; // ç°è´§è¿›ç¨‹ï¼šè“è‰²ç³»

            const getEnergyColor = (value, category) => {
                const palette = energyColorScale[category === 'actual' ? 'actual' : 'market'];
                const { min, max } = energyData.ranges[category === 'actual' ? 'actual' : 'market'];
                const safeSpan = max - min || 1;
                const ratio = Math.min(1, Math.max(0, safeSpan === 0 ? 0.5 : (value - min) / safeSpan));
                const idx = Math.min(palette.length - 1, Math.floor(ratio * (palette.length - 1)));
                return palette[idx];
            };

            // --- æ•°æ®é€‰æ‹©é€»è¾‘ ---
            const currentData = useMemo(() => {
                if (marketType === 'frequency') return frequencyData;
                if (energyView === 'spot-progress') return spotProgressData;
                return energyData;
            }, [marketType, energyView]);

            // --- æ•°æ®è½¬æ¢å‡½æ•° ---
            const convertPointData = (data) => {
                if(!data) return [];
                return data.map(item => {
                    const cfg = pointTypeConfig[item.type];
                    return {
                        name: item.name,
                        value: item.coord.concat(100),
                        symbol: cfg?.symbol || 'circle',
                        itemStyle: { 
                            color: cfg?.color || '#666', 
                            borderColor: '#fff', borderWidth: 2, shadowBlur: 5, shadowColor: 'rgba(0,0,0,0.5)' 
                        },
                        tooltipData: item
                    };
                });
            };
            const convertBeltBorderData = (data) => data ? data.map(item => ({ coords: item.coords, name: item.label })) : [];
            const convertBeltFillData = (data) => {
                if(!data) return [];
                return data.map(item => {
                    const cfg = pointTypeConfig[item.type];
                    return {
                        coords: item.coords,
                        lineStyle: { color: cfg?.beltColor || '#ccc' },
                        name: item.label,
                        tooltipData: { label: item.label, desc: 'åŒºåŸŸ/èµ°å»Š/äº§ä¸šå¸¦', type: item.type }
                    };
                });
            };
            
            // ç”Ÿæˆçƒ­åŠ›å›¾æ•°æ® (æ ¹æ®å½“å‰å¸‚åœºç±»å‹)
            const generateMapData = () => {
                const data = [];
                const values = currentData.mapValues || {};

                Object.keys(values).forEach(name => {
                    if (marketType === 'energy') {
                        if (energyView === 'price') {
                            const category = energyData.categoryMap[name];
                            const color = getEnergyColor(values[name], category);
                            data.push({
                                name,
                                value: values[name],
                                itemStyle: { areaColor: color, borderColor: '#fff', borderWidth: 1.2 },
                                emphasis: { itemStyle: { areaColor: currentPalette.highlight } },
                                energyCategory: category
                            });
                        } else if (energyView === 'spot-progress') {
                            const level = values[name] ?? 0;
                            const remark = currentData.remarkMap?.[name];
                            const policyInfo = currentData.policyMap?.[name];
                            data.push({
                                name,
                                value: level,
                                itemStyle: { areaColor: spotProgressColorScale[level] || spotProgressColorScale[0], borderColor: '#fff', borderWidth: 1.2 },
                                emphasis: { itemStyle: { areaColor: currentPalette.highlight } },
                                spotProgressLevel: level,
                                remark,
                                longPolicyLevel: policyInfo?.long,
                                spotPolicyLevel: policyInfo?.spot
                            });
                        }
                    } else {
                        data.push({ name: name, value: values[name] });
                    }
                });

                // åªæœ‰åœ¨è°ƒé¢‘å¸‚åœºæ—¶æ‰æ˜¾ç¤ºè¿™äº›ç‰¹å®šçš„è“æ¢¯é˜ŸèƒŒæ™¯
                if (marketType === 'frequency') {
                    deepBlueProvinces.forEach(name => !values[name] && data.push({ name, value: -3 }));
                    blueProvinces.forEach(name => !values[name] && data.push({ name, value: -2 }));
                    lightBlueProvinces.forEach(name => !values[name] && data.push({ name, value: -1 }));
                }
                return data;
            };

            // --- åŠ è½½åœ°å›¾ ---
            const loadMap = async (mode, provinceName = null) => {
                setLoading(true);
                try {
                    let geoJsonUrl = 'https://geo.datav.aliyun.com/areas_v3/bound/100000_full.json';
                    let mapName = 'china';

                    if (mode === 'province' && provinceName) {
                        const adcode = adcodeMap[provinceName];
                        if (adcode) {
                            geoJsonUrl = `https://geo.datav.aliyun.com/areas_v3/bound/${adcode}_full.json`;
                            mapName = provinceName;
                        }
                    }

                    const response = await fetch(geoJsonUrl);
                    const geoJson = await response.json();
                    
                    if (!window.echarts) return;
                    
                    window.echarts.registerMap(mapName, geoJson);
                    
                    if (chartInstanceRef.current) {
                        chartInstanceRef.current.dispose();
                    }
                    
                    const chart = window.echarts.init(mapContainerRef.current);
                    chartInstanceRef.current = chart;

                    let option = {};

                    if (mode === 'china') {
                        // === å…¨å›½è§†å›¾ ===
                        const frequencyPieces = [
                            { min: 4900, label: '5000ä¸‡', color: currentPalette.map[0] },
                            { min: 4050, max: 4899, label: '4100ä¸‡', color: currentPalette.map[1] },
                            { min: 3000, max: 4049, label: '4000ä¸‡', color: currentPalette.map[2] },
                            { min: 1000, max: 2999, label: '2500ä¸‡', color: currentPalette.map[3] },
                            { min: 0, max: 999, label: '500ä¸‡', color: currentPalette.map[4] },
                            { value: -3, label: 'ç¬¬ä¸€æ¢¯é˜Ÿ', color: '#1d4ed8' },
                            { value: -2, label: 'ç¬¬äºŒæ¢¯é˜Ÿ', color: '#60a5fa' },
                            { value: -1, label: 'ç¬¬ä¸‰æ¢¯é˜Ÿ', color: '#bfdbfe' }
                        ];

                        option = {
                            backgroundColor: 'transparent',
                            grid: { left: '5%', right: '5%', top: '5%', bottom: '5%' },
                                tooltip: {
                                    trigger: 'item',
                                    backgroundColor: 'rgba(255, 255, 255, 0.95)',
                                    borderColor: '#e2e8f0', borderWidth: 1, padding: 12, textStyle: { color: '#1e293b' },
                                    formatter: (params) => {
                                    if (params.data?.spotProgressLevel !== undefined) {
                                        const level = params.data.spotProgressLevel;
                                        const remark = params.data.remark || currentData.remarkMap?.[params.name];
                                        const color = spotProgressColorScale[level] || spotProgressColorScale[0];
                                        const longPolicy = params.data.longPolicyLevel;
                                        const spotPolicy = params.data.spotPolicyLevel;
                                        const policyLines = [
                                            longPolicy ? `<div style="font-size:12px; color:#1d4ed8;">ä¸­é•¿æœŸæ”¿ç­–ï¼š${longPolicy}çº§</div>` : '',
                                            spotPolicy ? `<div style="font-size:12px; color:#0ea5e9;">ç°è´§æ”¿ç­–ï¼š${spotPolicy}çº§</div>` : ''
                                        ].join('');
                                        return `<div style="font-weight:bold; font-size:14px; margin-bottom:4px;">${params.name}</div>`
                                            + `<div style="font-size:12px; color:#475569; margin-bottom:6px;">æˆç†Ÿåº¦ç­‰çº§ï¼š<span style="font-weight:bold; color:${color};">${level}çº§</span></div>`
                                            + policyLines
                                            + (remark ? `<div style="font-size:12px; color:#0f172a; font-weight:500; line-height:1.6;">${remark}</div>` : '')
                                            + `<div style="font-size:12px; color:#2563eb; font-weight:500; border-top:1px solid #f1f5f9; padding-top:4px; margin-top:6px;">ğŸ–± åŒå‡»è¿›å…¥çœçº§åœ°å›¾</div>`;
                                    }

                                    if (params.data?.energyCategory) {
                                        const categoryLabel = params.data.energyCategory === 'actual' ? 'å®æµ‹æ•°æ®' : 'å¸‚åœºåŒºé—´';
                                        const display = energyData.displayMap[params.name] || params.value;
                                        const note = energyData.noteMap[params.name];
                                        const range = energyData.rangeMap[params.name];
                                        const rangeLine = range ? `<div style="font-size:12px;color:#475569;margin-top:4px;">èŒƒå›´æ•°å€¼ï¼š${range[0]} ~ ${range[1]} å…ƒ/kWh</div>` : '';
                                        return `<div style="font-weight:bold; font-size:14px; margin-bottom:4px;">${params.name}</div>`
                                            + `<div style="font-size:12px; color:#475569; margin-bottom:6px;">ç±»åˆ«ï¼š<span style="font-weight:bold; color:${currentPalette.map[1]};">${categoryLabel}</span></div>`
                                            + `<div style="font-size:12px; color:#0ea5e9; font-weight:600;">${display}</div>`
                                            + (note ? `<div style="font-size:12px; color:#64748b; margin-top:4px;">${note}</div>` : '')
                                            + rangeLine
                                            + `<div style="font-size:12px; color:#0ea5e9; font-weight:500; border-top:1px solid #f1f5f9; padding-top:4px;">ğŸ–± åŒå‡»è¿›å…¥çœçº§åœ°å›¾</div>`;
                                    }

                                    if (marketType === 'frequency') {
                                        if (!params.value) return `<div style="color:#94a3b8">${params.name} <br/>æš‚æ— æ•°æ®</div>`;
                                        let colorDot = `<span style="display:inline-block;margin-right:6px;border-radius:50%;width:8px;height:8px;background-color:${Array.isArray(params.color) ? params.color[params.color.length-1] : params.color};"></span>`;
                                        if (params.value > 0) {
                                            const info = currentData.details[params.name] || {};
                                            const volume = info.totalVolume || params.value;
                                            const note = info.marketVolumeDisplay || '';
                                            const categoryLabel = 'å¸‚åœºæ€»é‡';
                                            return `<div style="font-weight:bold; font-size:14px; margin-bottom:4px;">${params.name}</div>`
                                                    + `<div style="font-size:12px; color:#475569; margin-bottom:6px;">${colorDot} ${categoryLabel}: <span style="font-weight:bold; color:${currentPalette.map[1]};">${volume}</span></div>`
                                                    + (note ? `<div style="font-size:12px; color:#64748b; margin-bottom:4px;">${note}</div>` : '')
                                                    + `<div style="font-size:12px; color:#0ea5e9; font-weight:500; border-top:1px solid #f1f5f9; padding-top:4px;">ğŸ–± åŒå‡»è¿›å…¥çœçº§åœ°å›¾</div>`;
                                        }
                                        return `<div style="font-weight:bold; font-size:14px; margin-bottom:4px;">${params.name}</div>`;
                                    }

                                    if (marketType === 'energy') {
                                        const info = currentData.details?.[params.name];
                                        if (info) {
                                            return `<div style="font-weight:bold; font-size:14px; margin-bottom:4px;">${params.name}</div>`
                                                + `<div style="font-size:12px; color:#475569; margin-bottom:6px;">${info.totalVolume}</div>`
                                                + `<div style="font-size:12px; color:#0f172a; line-height:1.5;">${info.marketVolumeDisplay}</div>`
                                                + `<div style="font-size:12px; color:#2563eb; font-weight:500; border-top:1px solid #f1f5f9; padding-top:4px; margin-top:6px;">ğŸ–± åŒå‡»è¿›å…¥çœçº§åœ°å›¾</div>`;
                                        }
                                    }
                                    return params.name;
                                }
                            },
                            ...(marketType === 'frequency' ? { visualMap: { show: false, type: 'piecewise', pieces: frequencyPieces } } : {}),
                            series: [{
                                name: 'å¸‚åœºåˆ†å¸ƒ',
                                type: 'map',
                                map: 'china',
                                roam: true,
                                zoom: 1.2,
                                center: [104.114129, 37.550339],
                                label: { show: true, fontSize: 10, color: 'rgba(0,0,0,0.5)' },
                                itemStyle: { areaColor: '#f8fafc', borderColor: '#cbd5e1', borderWidth: 1 },
                                emphasis: { label: { show: true, color: '#fff' }, itemStyle: { areaColor: currentPalette.highlight } },
                                data: generateMapData(),
                                selectedMode: false
                            }]
                        };
                    } else {
                        // === çœä»½è§†å›¾ ===
                        const pPoints = (currentData.provincePoints || {})[provinceName] || [];
                        const pBelts = (currentData.provinceBelts || {})[provinceName] || [];

                        option = {
                            backgroundColor: 'transparent',
                            tooltip: {
                                trigger: 'item',
                                backgroundColor: 'rgba(255, 255, 255, 0.95)',
                                borderColor: '#e2e8f0', borderWidth: 1, padding: 12, textStyle: { color: '#1e293b' },
                                formatter: (params) => {
                                    if (params.seriesType === 'effectScatter' || (params.seriesType === 'lines' && params.seriesName === 'èƒ½æºèµ°å»Š')) {
                                        const d = params.data.tooltipData;
                                        const typeInfo = pointTypeConfig[d.type] || { label: 'æœªçŸ¥' };
                                        return `<div style="font-weight:bold; margin-bottom:2px; color:${params.color}">${d.label}</div>
                                                <div style="font-size:12px;color:#64748b; margin-bottom:4px;">${d.desc || ''}</div>
                                                <div style="font-size:10px;color:#94a3b8;">ç±»å‹: ${typeInfo.label}</div>`;
                                    }
                                    return params.name;
                                }
                            },
                            geo: {
                                map: mapName, roam: true, zoom: 1.0,
                                label: { show: true, color: '#64748b' },
                                itemStyle: { areaColor: '#e2e8f0', borderColor: '#94a3b8', borderWidth: 1.5, shadowColor: 'rgba(0, 0, 0, 0.2)', shadowBlur: 10 },
                                emphasis: { itemStyle: { areaColor: '#cbd5e1' }, label: { color: '#0f172a' } }
                            },
                            series: [
                                {
                                    name: 'èƒ½æºèµ°å»Šè¾¹æ¡†', type: 'lines', coordinateSystem: 'geo', polyline: true,
                                    data: convertBeltBorderData(pBelts),
                                    lineStyle: { width: 26, color: 'rgba(255, 255, 255, 0.95)', cap: 'round', join: 'round', shadowBlur: 8, shadowColor: 'rgba(255, 255, 255, 0.8)' },
                                    silent: true, zlevel: 1.5
                                },
                                {
                                    name: 'èƒ½æºèµ°å»Š', type: 'lines', coordinateSystem: 'geo', polyline: true,
                                    data: convertBeltFillData(pBelts),
                                    lineStyle: { width: 20, opacity: 0.65, cap: 'round', join: 'round' },
                                    silent: false, zlevel: 1.6
                                },
                                {
                                    name: 'èƒ½æºåŸºåœ°', type: 'effectScatter', coordinateSystem: 'geo',
                                    data: convertPointData(pPoints),
                                    symbolSize: 18, showEffectOn: 'render', rippleEffect: { brushType: 'fill', scale: 2 },
                                    hoverAnimation: true, label: { show: false }, zlevel: 2
                                }
                            ]
                        };
                    }

                    chart.setOption(option);
                    setLoading(false);

                    chart.off('click');
                    chart.on('click', (params) => {
                        if (mode !== 'china') return;
                        if (params.componentType !== 'series' || params.seriesType !== 'map') return;
                        const clickedName = params.name;
                        const provinceInfo = currentData.details[clickedName];
                        if (provinceInfo) {
                            setSelectedProvinceInfo(provinceInfo);
                        } else {
                            setSelectedProvinceInfo(null);
                        }
                    });

                    chart.off('dblclick');
                    chart.on('dblclick', (params) => {
                        if (mode !== 'china') return;
                        if (params.componentType !== 'series' || params.seriesType !== 'map') return;
                        const clickedName = params.name;
                        if (adcodeMap[clickedName] && currentData.details[clickedName]) {
                            setCurrentProvince(clickedName);
                            setSelectedProvinceInfo(currentData.details[clickedName]);
                            setViewMode('province');
                        }
                    });

                } catch (error) {
                    console.error('Map loading failed:', error);
                    setLoading(false);
                }
            };

            // ç›‘å¬å˜åŒ–
            useEffect(() => {
                loadMap(viewMode, currentProvince);
            }, [viewMode, currentProvince, marketType, energyView]);

            // åˆ‡æ¢å¸‚åœºæ—¶é‡ç½®è§†å›¾
            useEffect(() => {
                setViewMode('china');
                setCurrentProvince(null);
                setSelectedProvinceInfo(null);
                if (marketType !== 'energy') {
                    setEnergyView('price');
                }
            }, [marketType]);

            // ç”µèƒ½é‡å†…éƒ¨è§†å›¾åˆ‡æ¢æ—¶é‡ç½®æ‰€é€‰çœä»½
            useEffect(() => {
                if (marketType === 'energy') {
                    setViewMode('china');
                    setCurrentProvince(null);
                    setSelectedProvinceInfo(null);
                }
            }, [energyView]);

            useEffect(() => {
                const handleResize = () => chartInstanceRef.current && chartInstanceRef.current.resize();
                window.addEventListener('resize', handleResize);
                return () => window.removeEventListener('resize', handleResize);
            }, []);

            const handleBack = () => {
                setViewMode('china');
                setCurrentProvince(null);
                setSelectedProvinceInfo(null);
            };

            const energyViewTitle = energyView === 'price'
                ? 'ç”µèƒ½é‡å¸‚åœºçƒ­åŠ›å›¾'
                : 'ç°è´§å¸‚åœºè¿›ç¨‹çƒ­åŠ›å›¾ï¼ˆå«æ”¿ç­–ä¿¡æ¯ï¼‰';

            const detailSummaryTitle = marketType === 'frequency'
                ? 'è°ƒé¢‘æ”¶ç›Šæ¦‚è§ˆ'
                : energyView === 'price'
                    ? 'ç”µèƒ½é‡å¸‚åœºæ¦‚è§ˆ'
                    : 'ç°è´§å¸‚åœºè¿›ç¨‹æ¦‚è§ˆ';

            return (
                <div className="flex flex-col h-screen bg-slate-50 font-sans text-slate-800 overflow-hidden relative">
                    <header className="bg-white shadow-sm border-b border-slate-200 px-6 py-4 flex items-center justify-between z-10 shrink-0 relative">
                        <div className="flex items-center space-x-3">
                            {viewMode === 'province' ? (
                                <button onClick={handleBack} className="flex items-center gap-2 px-3 py-1.5 bg-slate-100 hover:bg-slate-200 text-slate-700 rounded-lg transition-colors text-sm font-medium">
                                    <ArrowLeft size={16} /> è¿”å›å…¨å›½
                                </button>
                            ) : (
                                <div className={`bg-gradient-to-br ${currentPalette.gradientFrom} ${currentPalette.gradientTo} p-2.5 rounded-xl text-white shadow-md transition-all duration-500`}>
                                    <Activity size={24} />
                                </div>
                            )}
                            
                            <div>
                                <h1 className="text-xl font-bold text-slate-900 tracking-tight">
                                    {viewMode === 'province' ? `${currentProvince}è¯¦æƒ…` : (marketType === 'frequency' ? 'äºŒæ¬¡è°ƒé¢‘å¸‚åœºçƒ­åŠ›å›¾' : energyViewTitle)}
                                </h1>
                                <div className="flex items-center gap-2 text-xs text-slate-500 mt-0.5">
                                    <span className={`px-1.5 py-0.5 rounded border flex items-center gap-1 ${currentPalette.iconBg} ${currentPalette.iconText} ${currentPalette.iconBorder}`}>
                                        {viewMode === 'province' ? <MapIcon size={12} /> : <Zap size={12} fill="currentColor" />}
                                        <span>{viewMode === 'province' ? 'çœå†…å¾®è§‚è§†è§’' : 'å…¨å›½å®è§‚è§†è§’'}</span>
                                    </span>
                                </div>
                            </div>
                        </div>
                    </header>

                    <div className="flex-1 relative w-full h-full overflow-hidden">
                        <div className="w-full h-full bg-slate-50 flex">
                            
                            {/* --- å·¦ä¾§ä¼¸ç¼©é¢æ¿ --- */}
                            <div className={`absolute left-0 top-0 bottom-0 z-40 bg-white/95 backdrop-blur shadow-xl border-r border-slate-200 transition-all duration-300 ease-in-out flex flex-col ${isSidebarOpen ? 'w-72 translate-x-0' : 'w-0 -translate-x-full overflow-hidden'}`}>
                                <div className="p-4 border-b border-slate-100 flex justify-between items-center bg-slate-50 shrink-0">
                                    <div className="flex items-center gap-2 text-slate-700 font-bold">
                                        <Layers size={18} />
                                        <span>å¸‚åœºè§†å›¾åˆ‡æ¢</span>
                                    </div>
                                </div>
                                
                                <div className="p-4 overflow-y-auto flex-1 space-y-6">
                                    
                                    {/* 0. å¸‚åœºç±»å‹åˆ‡æ¢å™¨ (æ ¸å¿ƒåŠŸèƒ½) */}
                                    <div className="p-1 bg-slate-100 rounded-lg flex gap-1">
                                        <button
                                            onClick={() => setMarketType('frequency')}
                                            className={`flex-1 py-2 px-2 rounded-md text-xs font-bold transition-all flex items-center justify-center gap-1 ${marketType === 'frequency' ? 'bg-white text-red-600 shadow-sm' : 'text-slate-500 hover:text-slate-700'}`}
                                        >
                                            <Activity size={14} /> äºŒæ¬¡è°ƒé¢‘
                                        </button>
                                        <button
                                            onClick={() => setMarketType('energy')}
                                            className={`flex-1 py-2 px-2 rounded-md text-xs font-bold transition-all flex items-center justify-center gap-1 ${marketType === 'energy' ? 'bg-white text-indigo-600 shadow-sm' : 'text-slate-500 hover:text-slate-700'}`}
                                        >
                                            <BatteryCharging size={14} /> ç”µèƒ½é‡
                                        </button>
                                    </div>

                                    {/* ç”µèƒ½é‡è§†å›¾åˆ‡æ¢å™¨ */}
                                    {marketType === 'energy' && (
                                        <div className="space-y-2 bg-indigo-50/60 border border-indigo-100 rounded-lg p-3">
                                            <div className="text-[11px] text-indigo-700 font-semibold flex items-center gap-2">
                                                <Layers size={12} /> ç”µèƒ½é‡è§†å›¾é€‰æ‹©
                                            </div>
                                            <div className="grid grid-cols-2 gap-2">
                                                <button
                                                    onClick={() => setEnergyView('price')}
                                                    className={`px-2 py-1.5 rounded-md text-[11px] font-bold border transition-all ${energyView === 'price' ? 'bg-white text-indigo-700 border-indigo-200 shadow-sm' : 'text-slate-600 border-slate-200 hover:border-indigo-200 hover:text-indigo-700 bg-white/70'}`}
                                                >
                                                    ä»·å·®åœ°å›¾
                                                </button>
                                                <button
                                                    onClick={() => setEnergyView('spot-progress')}
                                                    className={`px-2 py-1.5 rounded-md text-[11px] font-bold border transition-all ${energyView === 'spot-progress' ? 'bg-white text-indigo-700 border-indigo-200 shadow-sm' : 'text-slate-600 border-slate-200 hover:border-indigo-200 hover:text-indigo-700 bg-white/70'}`}
                                                >
                                                    ç°è´§å¸‚åœºè¿›ç¨‹
                                                </button>
                                            </div>
                                            <div className="text-[11px] text-slate-600 leading-relaxed">
                                                åœ¨ä»·å·®ä¸ç°è´§è¿›ç¨‹ï¼ˆå«æ”¿ç­–ä¿¡æ¯ï¼‰ä¸¤å¼ çƒ­åŠ›å›¾é—´åˆ‡æ¢ï¼Œé¢œè‰²å‡æŒ‰ç¨‹åº¦ç”±æµ…åˆ°æ·±é€’è¿›æ˜¾ç¤ºã€‚
                                            </div>
                                        </div>
                                    )}

                                    {/* 1. æ”¶ç›Š/çƒ­åº¦å›¾ä¾‹ */}
                                    {viewMode === 'china' && (
                                        <div className="space-y-3 animate-in fade-in slide-in-from-left-4 duration-500">
                                            <div className="text-xs font-bold text-slate-500 uppercase tracking-wider">
                                                {marketType === 'frequency' ? 'è°ƒé¢‘æ”¶ç›Š (çƒ­åº¦)' : (energyView === 'price' ? 'ç”µèƒ½é‡ä»·å·®çƒ­åŠ›å›¾' : energyView === 'spot-progress' ? 'ç°è´§å¸‚åœºè¿›ç¨‹çƒ­åŠ›å›¾' : 'ç”µèƒ½é‡æ”¿ç­–çƒ­åŠ›å›¾')}
                                            </div>
                                            {marketType === 'frequency' ? (
                                                <div className="flex items-center gap-3">
                                                    <div className="h-32 w-2 rounded-full shadow-inner bg-gradient-to-b from-[#991b1b] via-[#ea580c] to-[#fef08a]"></div>
                                                    <div className="flex flex-col justify-between h-32 text-xs text-slate-600 font-medium">
                                                        <span>é«˜</span>
                                                        <span>ä¸­é«˜</span>
                                                        <span>ä¸­</span>
                                                        <span>ä¸­ä½</span>
                                                        <span>ä½</span>
                                                    </div>
                                                </div>
                                            ) : energyView === 'price' ? (
                                                <div className="space-y-4">
                                                    <div className="flex items-center gap-3">
                                                        <div className="h-24 w-3 rounded-full shadow-inner bg-gradient-to-b from-[#fef3c7] via-[#fde68a] to-[#f59e0b]"></div>
                                                        <div className="flex flex-col justify-between h-24 text-[11px] text-slate-600 font-medium">
                                                            {actualScaleLabels.map((label, idx) => (
                                                                <span key={`actual-scale-${idx}`}>{formatPriceLabel(label)}</span>
                                                            ))}
                                                        </div>
                                                        <span className="text-[11px] text-amber-700 font-semibold px-2 py-1 bg-amber-50 border border-amber-100 rounded">å®æµ‹çœä»½</span>
                                                    </div>
                                                    <div className="flex items-center gap-3">
                                                        <div className="h-24 w-3 rounded-full shadow-inner bg-gradient-to-b from-[#f0f9ff] via-[#7dd3fc] to-[#0ea5e9]"></div>
                                                        <div className="flex flex-col justify-between h-24 text-[11px] text-slate-600 font-medium">
                                                            {marketScaleLabels.map((label, idx) => (
                                                                <span key={`market-scale-${idx}`}>{formatPriceLabel(label)}</span>
                                                            ))}
                                                        </div>
                                                        <span className="text-[11px] text-sky-700 font-semibold px-2 py-1 bg-sky-50 border border-sky-100 rounded">å¸‚åœºåŒºé—´çœä»½</span>
                                                    </div>
                                                    <div className="text-[11px] leading-relaxed text-slate-600 bg-slate-50 border border-slate-100 rounded-lg p-2">
                                                        å›¾ä¾‹æ˜¾ç¤ºæ»‘å—ä¸¤ç«¯çš„çº¦å€¼ï¼ˆæ— å•ä½ï¼‰ï¼Œç‚¹å‡»çœä»½æŸ¥çœ‹åŒºé—´æˆ–å¤‡æ³¨ã€‚
                                                    </div>
                                                </div>
                                            ) : (
                                                <div className="space-y-3 text-[11px] text-slate-700">
                                                    <div className="flex items-center gap-3">
                                                        <div
                                                            className="h-32 w-3 rounded-full shadow-inner"
                                                            style={{
                                                                background: 'linear-gradient(to bottom, #1d4ed8 0%, #4f8df9 30%, #8abaff 55%, #b7d7ff 78%, #e0f2ff 90%, #ffffff 100%)'
                                                            }}
                                                        ></div>
                                                        <div className="flex flex-col justify-between h-32 text-[11px] text-slate-600 font-medium">
                                                            {[5,4,3,2,1,0].map((level) => (
                                                                <span key={`progress-${level}`}>{`${level}çº§`}</span>
                                                            ))}
                                                        </div>
                                                    </div>
                                                    <div className="text-[11px] leading-relaxed text-slate-600 bg-slate-50 border border-slate-100 rounded-lg p-2">
                                                        0-5çº§é€çº§åŠ æ·±ï¼Œ0 ä¸ºæš‚æ— ä¿¡æ¯ï¼Œ5 ä¸ºæ­£å¼è¿è¡Œï¼›æ‚¬åœæˆ–ç‚¹å‡»å¯æŸ¥çœ‹å¤‡æ³¨ä¸æ”¿ç­–ç­‰çº§ã€‚
                                                    </div>
                                                </div>
                                            )}
                                        </div>
                                    )}

                                    <div className="border-t border-slate-100"></div>

                                    {/* 2. èƒ½æºåŸºåœ°ç±»å‹å›¾ä¾‹ */}
                                    <div className="space-y-3">
                                        <div className="text-xs font-bold text-slate-500 uppercase tracking-wider">èƒ½æºåŸºåœ°å›¾ä¾‹</div>
                                        <div className="space-y-2 text-xs text-slate-700">
                                            {Object.entries(pointTypeConfig).map(([key, cfg]) => (
                                                <div key={key} className="flex items-center gap-2 p-2 rounded hover:bg-slate-50 transition-colors">
                                                    {cfg.symbol === 'circle' && <div className="w-3 h-3 rounded-full border border-white shadow-sm flex-shrink-0" style={{backgroundColor: cfg.color}}></div>}
                                                    {cfg.symbol === 'rect' && <div className="w-3 h-3 border border-white shadow-sm flex-shrink-0" style={{backgroundColor: cfg.color}}></div>}
                                                    {cfg.symbol === 'triangle' && <div className="w-3 h-3 border border-white shadow-sm flex-shrink-0" style={{backgroundColor: cfg.color, clipPath: 'polygon(50% 0%, 0% 100%, 100% 100%)'}}></div>}
                                                    {cfg.symbol === 'diamond' && <div className="w-3 h-3 border border-white shadow-sm flex-shrink-0 rotate-45" style={{backgroundColor: cfg.color}}></div>}
                                                    <span>{cfg.label}</span>
                                                </div>
                                            ))}
                                            <div className="flex items-center gap-2 p-2 rounded hover:bg-slate-50 transition-colors">
                                                <div className="w-8 h-3 bg-slate-300 rounded border border-white shadow-sm flex items-center justify-center relative flex-shrink-0">
                                                    <div className="w-6 h-1 bg-slate-400/50 rounded-full"></div>
                                                </div>
                                                <span className="text-slate-500">èµ°å»Š/äº§ä¸šå¸¦</span>
                                            </div>
                                        </div>
                                    </div>

                                    {/* 3. æ¢¯é˜Ÿä¿¡æ¯ (ä»…è°ƒé¢‘æ˜¾ç¤º) */}
                                    {marketType === 'frequency' && viewMode === 'china' && (
                                        <>
                                            <div className="border-t border-slate-100"></div>
                                            <div className="space-y-3">
                                                <div className="text-xs font-bold text-slate-500 uppercase tracking-wider">æ½œåœ¨å¸‚åœº (æ¢¯é˜Ÿ)</div>
                                                <div className="space-y-2 text-xs text-slate-700">
                                                    <div className="flex items-center gap-2"><div className="w-2.5 h-2.5 rounded bg-[#1d4ed8]"></div><span>ç¬¬ä¸€æ¢¯é˜Ÿ</span></div>
                                                    <div className="flex items-center gap-2"><div className="w-2.5 h-2.5 rounded bg-[#60a5fa]"></div><span>ç¬¬äºŒæ¢¯é˜Ÿ</span></div>
                                                    <div className="flex items-center gap-2"><div className="w-2.5 h-2.5 rounded bg-[#bfdbfe]"></div><span>ç¬¬ä¸‰æ¢¯é˜Ÿ</span></div>
                                                </div>
                                            </div>
                                        </>
                                    )}
                                    
                                    <div className="pt-4 text-center">
                                        <div className="text-[10px] text-slate-300 border border-dashed border-slate-200 rounded p-2 hover:border-slate-300 hover:text-slate-400 cursor-pointer transition-colors">
                                            + æ·»åŠ æ›´å¤šç­›é€‰å™¨ (é¢„ç•™)
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <button 
                                onClick={() => setIsSidebarOpen(!isSidebarOpen)}
                                className={`absolute top-4 z-30 bg-white p-2 rounded-r-lg shadow-md border border-l-0 border-slate-200 text-slate-500 hover:text-slate-800 hover:bg-slate-50 transition-all duration-300 ${isSidebarOpen ? 'left-72' : 'left-0'}`}
                            >
                                {isSidebarOpen ? <ChevronLeft size={16} /> : <ChevronRight size={16} />}
                            </button>

                            <div className="flex-1 relative">
                                {loading && (
                                    <div className="absolute inset-0 flex flex-col items-center justify-center text-slate-400 gap-3 bg-slate-50 z-50">
                                        <div className="w-8 h-8 border-4 border-current border-t-transparent rounded-full animate-spin text-blue-500"></div>
                                        <span className="text-sm">æ­£åœ¨é‡ç»˜åœ°å›¾...</span>
                                    </div>
                                )}
                                <div ref={mapContainerRef} className="w-full h-full cursor-pointer" />
                            </div>
                        </div>

                        {/* å³ä¾§è¯¦æƒ…é¢æ¿ */}
                        <div className={`absolute right-0 top-0 bottom-0 z-30 w-full md:w-[400px] bg-white shadow-2xl md:border-l border-slate-200 transform transition-transform duration-300 ease-in-out flex flex-col ${selectedProvinceInfo ? 'translate-x-0' : 'translate-x-full'}`}>
                            {selectedProvinceInfo && (
                                <>
                                    <div className="p-6 border-b border-slate-100 flex justify-between items-start bg-gradient-to-br from-slate-50 to-white">
                                        <div>
                                            <div className="flex items-center gap-2 mb-1"><h2 className="text-2xl font-bold text-slate-800">{selectedProvinceInfo.title}</h2></div>
                                            <div className="flex flex-wrap gap-2 mt-2">
                                                {selectedProvinceInfo.totalVolume && <span className={`inline-flex items-center px-2 py-0.5 rounded text-xs font-bold border shadow-sm ${marketType === 'frequency' ? 'bg-red-100 text-red-700 border-red-200' : 'bg-indigo-100 text-indigo-700 border-indigo-200'}`}>æ€»é‡: {selectedProvinceInfo.totalVolume}</span>}
                                                {selectedProvinceInfo.tags && selectedProvinceInfo.tags.map((tag, i) => <span key={i} className="inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-slate-100 text-slate-600 border border-slate-200">{tag}</span>)}
                                            </div>
                                        </div>
                                        <button onClick={() => setSelectedProvinceInfo(null)} className="p-2 hover:bg-slate-100 rounded-full text-slate-400 hover:text-slate-600 transition-all"><X size={24} /></button>
                                    </div>
                                    <div className="p-6 overflow-y-auto space-y-6 flex-1 bg-white">
                                        {/* åŠ¨æ€å¡ç‰‡é¢œè‰² */}
                                        <div className={`rounded-xl p-5 border shadow-sm relative overflow-hidden ${marketType === 'frequency' ? 'bg-white border-red-100 shadow-red-50/50' : 'bg-white border-indigo-100 shadow-indigo-50/50'}`}>
                                            {selectedProvinceInfo.heatValue > 0 && <div className={`absolute top-0 right-0 w-16 h-16 bg-gradient-to-bl -mr-4 -mt-4 rounded-full opacity-50 ${marketType === 'frequency' ? 'from-red-50' : 'from-indigo-50'}`}></div>}
                                            <div className={`flex items-center gap-2 font-semibold mb-3 ${marketType === 'frequency' ? 'text-red-600' : 'text-indigo-600'}`}>
                                                {marketType === 'frequency' ? <Coins size={20} /> : <Zap size={20} />}
                                                <span>{detailSummaryTitle}</span>
                                            </div>
                                            <p className="text-lg text-slate-800 font-medium leading-relaxed">{selectedProvinceInfo.marketVolumeDisplay}</p>
                                        </div>
                                        
                                        {selectedProvinceInfo.details && (
                                            <div className="space-y-4">
                                                <div className="flex items-center gap-2 text-xs font-bold text-slate-400 uppercase tracking-wider"><BarChart3 size={14} />è¯¦ç»†æ•°æ® / è°ƒç ”æƒ…å†µ</div>
                                                <div className="bg-slate-50 rounded-xl border border-slate-100 divide-y divide-slate-100">
                                                    {selectedProvinceInfo.details.map((item, idx) => (
                                                        <div key={idx} className="p-4 flex flex-col gap-1.5 hover:bg-slate-50/80 transition-colors">
                                                            <span className="text-xs text-slate-500 font-medium flex items-center gap-1"><span className="w-1 h-1 rounded-full bg-slate-400"></span>{item.label}</span>
                                                            <span className="text-slate-900 text-sm leading-relaxed pl-2 border-l-2 border-slate-200">{item.value}</span>
                                                        </div>
                                                    ))}
                                                </div>
                                            </div>
                                        )}
                                    </div>
                                </>
                            )}
                        </div>
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<EnergyMarketMap />);
    </script>
</body>

</html>
